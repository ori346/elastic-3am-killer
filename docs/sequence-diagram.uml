@startuml
title Elastic 3AM Alert Killer - Phase 2\nComplete Remediation Workflow

participant "Alertmanager" as AlertSys
participant "Elastic-Agent" as Elastic
participant "Host\nOrchestrator" as Host
participant "Remediation\nAgent" as Remediation
participant "OpenShift\nCluster" as OpenShift

participant "Report Maker\nAgent" as Report

== PHASE 0: Elastic Agent symptoms alert==
AlertSys -> Elastic: 1. Detect Alert\n(HighQueueDepth)
Elastic -> Host: 2. POST /\n(A2A Message with symptoms)
Host -> Host: 3. store_alert_info(\n  alert_name, namespace,\n  diagnostics)
note right: Store alert metadata\nin shared context

== PHASE 1: Investigation & Planning ==
Host -> Remediation: 4. Handoff to\nRemediation Agent
activate Remediation

Remediation -> Remediation: 5. read_alert_diagnostics_data()

loop Bounded number of times
  Remediation -> OpenShift: 6. use_tools(param)
  OpenShift --> Remediation: 7. tools_result
end

Remediation -> Remediation: 8. write_remediation_plan(explanation, commands)
note right: Write commands to\ncontext["remediation_plan"]

Remediation -> Host: 9. Handoff back with plan
deactivate Remediation

== PHASE 2: Execution ==
note right of Host: Read commands from\ncontext["remediation_plan"]

loop Each command in remediation_plan
  Host -> OpenShift: 10. Execute command
  OpenShift --> Host: 11. Execution result
end

note right of Host: Store results in\ncontext["commands_execution_results"]

== PHASE 3: Report ==
Host -> Report: 12. Handoff to\nReport Maker Agent
activate Report 
Report -> Report: 14. Convert the context to text
Report -> Report: 15. query_context(\n  "query")

Report -> Report: 16. write_report_to_context(\n  report_dict)
Report -> Host: 17. Report Generated\n Remediation Process Complete
Host -> Elastic: 18. send_report

== PHASE 4: Verification ==
Elastic -> AlertSys: 19. check_alert_status
alt Remediation Failed
  note over Elastic, Host: Restart workflow from step 2\n(POST A2A Message with symptoms and previous report)
  Elastic -> Host: 20. Trigger new workflow
else Remediation Succeeded
  note over Elastic: Workflow complete
end


@enduml