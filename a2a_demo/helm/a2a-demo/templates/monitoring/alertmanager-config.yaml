{{- if and .Values.prometheus.enabled .Values.prometheus.alertmanager.enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: alertmanager-config
  labels:
    app: a2a-demo
    chart: {{ .Chart.Name }}-{{ .Chart.Version }}
data:
  alertmanager.yml: |
    global:
      resolve_timeout: 5m

    route:
      group_by: ['alertname', 'cluster']
      group_wait: 10s
      group_interval: 10s
      repeat_interval: 12h
      receiver: 'agent1-webhook'
      routes:
      - match:
          alertname: HighQueueDepth
        receiver: 'agent1-webhook'
        continue: false

    receivers:
    - name: 'agent1-webhook'
      webhook_configs:
      - url: 'http://{{ .Values.agent1.service.name }}:{{ .Values.agent1.service.port }}/webhook'
        send_resolved: true
        http_config:
          follow_redirects: true
{{- end }}
